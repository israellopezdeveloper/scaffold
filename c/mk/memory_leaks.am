if ENABLE_MEMORY_LEAK

leak-check: $(check_PROGRAMS)
	@echo "Running memory leak check ..."
	@for f in $$(ls tests/.libs/*_leak); do \
    if [ -f "$$f" ] && [ -x "$$f" ]; then \
      $(MEMORY_LEAK_DIAGNOSTIC) "$$f" > output.log 2>&1; \
      if grep -q "no leaks are possible" output.log; then \
        echo "No memory leaks detected at $$f"; \
      else \
        echo "Memory leaks detected at $$f"; \
        exit 1; \
      fi; \
    fi; \
  done
endif
