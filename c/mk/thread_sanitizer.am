if ENABLE_THREAD_SANITIZER
thread-check: $(check_PROGRAMS)
	@echo "Running thread sanitizer..."
	@for f in $$(ls tests/*_test); do \
    echo "" > output.log; \
    if [ -x "$$f" ]; then \
      "$$f" 2> output.log > /dev/null; \
      if grep -q "WARNING: ThreadSanitizer" output.log; then \
        echo "Thread issues detected at $$f"; \
        exit 1; \
      else \
        echo "No thread issues detected at $$f"; \
      fi; \
    fi; \
  done
endif
